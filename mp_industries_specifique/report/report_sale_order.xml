<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="report_saleorder_document_mp_industries" inherit_id="sale.report_saleorder_document">

        <xpath expr="//div[hasclass('page')]" position="before">
            <t t-set="information_block">
                <strong t-if="doc.order_comment">Réference :</strong>
                <div t-if="doc.order_comment" t-field="doc.order_comment"/>
            </t>
        </xpath>


        <xpath expr="//div[@t-field='doc.partner_id']" position="attributes">
            <attribute name="t-options-fields">['address', 'name', 'phone', 'mobile', 'email', 'vat']</attribute>
        </xpath>

        <xpath expr="//div[@t-field='doc.partner_id']" position="attributes">
            <attribute name="t-options-no_marker">False</attribute>
        </xpath>

        <xpath expr="//p[@t-field='doc.validity_date']" position="attributes">
            <attribute name="t-options-widget">"date"</attribute>
        </xpath>

        <xpath expr="//p[@t-field='doc.date_order']" position="attributes">
            <attribute name="t-options-widget">"date"</attribute>
        </xpath>

        <xpath expr="//div[@t-if='doc.user_id.name']" position="attributes">
            <attribute name="t-if">False</attribute>
        </xpath>

        <xpath expr="//div[@id='informations']" position="after">
            <div t-if="doc.user_id.name">
                <br/>
                <span><strong>Commercial : </strong></span>
                <span t-field="doc.user_id"/>
                <span t-if="doc.user_id.phone"><strong> Tel : </strong></span>
                <span class="m-0" t-if="doc.user_id.phone" t-field="doc.user_id.phone"/>
                 <span t-if="doc.user_id.mobile"><strong> Mobile : </strong></span>
                <span class="m-0" t-if="doc.user_id.mobile" t-field="doc.user_id.mobile"/>
                 <span t-if="doc.user_id.email_normalized"><strong> Email : </strong></span>
                <span class="m-0" t-if="doc.user_id.email_normalized" t-field="doc.user_id.email_normalized"/>
                <br/>
            </div>
        </xpath>

        <xpath expr="//th[@name='th_taxes']" position="before">
            <th name="th_pricereduce" class="text-right">PU Net</th>
        </xpath>

        <xpath expr="//td[@name='td_taxes']" position="before">
            <td name="td_pricereduce" class="text-right">
                <span t-field="line.price_reduce"/>
            </td>
        </xpath>

        <xpath expr="//th[@name='th_description']" position="attributes">
            <attribute name="style" separator=";" add="width:300px"/>
        </xpath>

        <xpath expr="//th[@name='th_taxes']" position="attributes">
            <attribute name="t-if">False</attribute>
        </xpath>
        <xpath expr="//td[@name='td_taxes']" position="attributes">
            <attribute name="t-if">False</attribute>
        </xpath>

        <xpath expr="//th[@name='th_priceunit']" position="replace">
            <th name="th_priceunit" class="text-right">PU Brut</th>
        </xpath>


        <xpath expr="//div[@id='informations']" position="inside">
            <div t-if="doc.pricelist_id " class="col-3 bm-2">
                <strong>Tarif :</strong>
                <p t-field="doc.pricelist_id" class="m-0"/>
            </div>
        </xpath>

        <xpath expr="//div[@id='informations']" position="inside">
            <t t-if="doc.state not in ['draft','sent']">
                <div t-if="doc.commitment_date" class="col-3 bm-2">
                    <t t-set="date_week" t-value="doc.commitment_date.isocalendar()[1]"></t>
                    <strong>Délai (n° semaine):</strong>
                    <p t-esc="date_week" class="m-0"/>
                </div>
            </t>
        </xpath>

        <xpath expr="//div[@name='so_total_summary']" position="after">
            <div class="row" t-if="doc.carrier_id and doc.state not in ['draft','sent']">
                <div class="col-2">
                    <span>
                        <strong>Transporteur :</strong>
                    </span>

                </div>
                <div class="col-10">
                    <span t-field="doc.carrier_id"/>
                </div>
            </div>
        </xpath>


        <xpath expr="//div[@name='so_total_summary']" position="after">
            <div class="row" t-if="doc.order_weight">
                <div class="col-2">
                    <span>
                        <strong>Poids :</strong>
                    </span>

                </div>
                <div class="col-10">
                    <span t-field="doc.order_weight"/>
                    Kg
                </div>
            </div>
            <div class="row" t-if="doc.order_volume">
                <div class="col-2">
                    <span>
                        <strong>Volume :</strong>
                    </span>

                </div>
                <div class="col-10">
                    <span t-field="doc.order_volume"/>
                    m3
                </div>
            </div>
        </xpath>

        <xpath expr="//p[@id='fiscal_position_remark']" position="after">
            <div t-if="doc.state == 'draft'" class="mt32 ml64 mr4" name="accord" style="page-break-inside: avoid;">
                <div class="offset-8">
                    <img class="img-fluid" src="/mp_industries_specifique/static/src/img/bon_pour_accord.png"/>
                    <!--                    <strong>Bon pour accord</strong>-->
                </div>
            </div>
        </xpath>


    </template>

    <template id="sale_two_level_discounts.report_saleorder_document_quotation_two_discount"
              inherit_id="sale.report_saleorder_document">

        <xpath expr="//span[@t-field='line.discount']" position="after">
            <div t-if="line.discount2">
                +
                <span class="text-nowrap" t-field="line.discount2"/>
            </div>
        </xpath>

        <xpath expr="//t[@t-set='display_discount']" position="attributes">
            <attribute name="t-value">any(l.discount for l in doc.order_line) or any(l.discount2 for l in
                doc.order_line)
            </attribute>
        </xpath>

    </template>

</odoo>
